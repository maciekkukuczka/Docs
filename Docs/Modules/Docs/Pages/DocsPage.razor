@namespace Docs.Modules.Items.Pages

@page "/"
@* @inherits DocsPageBase *@
@attribute [Authorize]

<PageTitle>Docs</PageTitle>

<SectionContent SectionId="@MainLayout.TopBarSectionRight">
    <MudButton OnClick="AddDoc" Variant="Variant.Filled"Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add">Dodaj</MudButton>
</SectionContent>

<MudGrid>

    <MudItem xs="12">
        @* <SubjectDisplayComp/> *@
        <SubjectDisplayComp OnSubjectSelected="@OnSubjectSelected"/>
        <CategoriesDisplayComp OnCategorySelected="@OnCategorySelected" SelectedSubjectIId="@selectedSubject?.Id"/>
        @if (docs is null || !docs.Any())
        {
            <NoDataComp/>
        }
        else
        {
            <MudDataGrid @ref="dataGrid" Items="@docs" QuickFilter="SearchFilter">
                <ToolBarContent>
                    <MudText Typo="Typo.h6">Docsy</MudText>
                    <MudSpacer/>
                    <MudTextField @bind-Value="searchString" Placeholder="Szukaj" Adornment="Adornment.Start" Immediate="true"
                                  AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0">
                    </MudTextField>
                </ToolBarContent>
                <Columns>
                    <TemplateColumn >
                        <CellTemplate >
                            @* @(docs.IndexOf(context.Item) + 1) *@
                        </CellTemplate>
                    </TemplateColumn>
                    
                    @* Title *@
                    <TemplateColumn Title="Nazwa">
                        <CellTemplate>
                            @* <MudLink Href="@($"/doc-details/{context.Item.Id}")" Underline="Underline.Always">@context.Item.Title</MudLink> *@
                            <MudButton Variant="Variant.Text" Color="Color.Primary" Size="Size.Small"
                                       OnClick="@(() => Edit(context.Item))">
                                @context.Item.Title
                            </MudButton>
                        </CellTemplate>
                    </TemplateColumn>
                    <PropertyColumn Property="x => x.ShortDescription" Title="Krótki opis"/>

                    @* Subjects *@
                    <TemplateColumn TItle="Tematy">
                        <CellTemplate>
                            @foreach (var subject in context.Item?.Subjects)
                            {
                                <span>@subject.Name</span>
                            }
                        </CellTemplate>
                    </TemplateColumn>
                    
                    @* Categories *@
                    <TemplateColumn TItle="Kategorie">
                        <CellTemplate>
                            @foreach (var category in context.Item?.Categories)
                            {
                                <span>@category.Name</span>
                            }
                        </CellTemplate>
                    </TemplateColumn>
                    
                    @* Buttons *@
                    <TemplateColumn CellClass="d-flex justify-end">
                        <CellTemplate>
                            <MudStack Row>
                                @*<MudButton Variant="Variant.Filled" Color="Color.Warning" Size="Size.Small" StartIcon="@Icons.Custom.Uncategorized.Radioactive"
                                           OnClick="@(() => Edit(context.Item))">
                                    Edytuj
                                </MudButton>*@
                                <MudButton Variant="Variant.Filled" Color="Color.Error" Size="Size.Small" StartIcon="@Icons.Material.Filled.DeleteForever"
                                           OnClick="@(() => Remove(context.Item.Id))">
                                    Usuń
                                </MudButton>
                            </MudStack>
                        </CellTemplate>
                    </TemplateColumn>
                </Columns>
            </MudDataGrid>
        }
    </MudItem>
</MudGrid>